(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("koa");var a=e.n(t);const r=require("@koa/router");var n=e.n(r);const l=require("koa-static");var o=e.n(l);const c=require("fs");var u=e.n(c);const s=require("path");var i=e.n(s);const d=require("react");var m=e.n(d);const E=require("react-dom/server"),p=require("react-router-dom/server"),h=require("react-router-dom"),v=function(){return m().createElement(m().Fragment,null,m().createElement("main",null,m().createElement("h2",null,"Welcome to the homepage!"),m().createElement("p",null,"You can do this, I believe in you.")),m().createElement("nav",null,"Home"))},g=require("axios");var y=e.n(g);const f=require("react-redux");function q(e){const[t,a]=(0,d.useState)("");return(0,d.useEffect)((()=>{e.data||y().get("http://localhost:3000/getData").then((t=>{e.dispatch({type:"CHANGE_STATE",payload:{data:t.data.data}})}))}),[]),m().createElement(m().Fragment,null,m().createElement("main",null,m().createElement("h2",null,"Who are we?")),m().createElement("nav",null,"About"),m().createElement("div",null,e.data))}q.loadData=e=>new Promise((t=>{y().get("http://localhost:3000/getData").then((a=>{e.dispatch({type:"CHANGE_STATE",payload:{data:a.data.data}}),t(a.data.data)}))}));const S=(0,f.connect)((function(e){return{data:e.data}}),(function(e){return{dispatch:e}}))(q),b=[{path:"/",index:!0,element:m().createElement(v,null)},{path:"/about",element:m().createElement(S,null)}],w=()=>(0,h.useRoutes)(b),A=require("redux"),T={data:""};function _(e=T,t){return"CHANGE_STATE"===t.type?{...e,...t.payload}:{...e}}const D=()=>m().createElement("div",null,m().createElement("p",null,m().createElement(h.Link,{to:"/"},"Home")),m().createElement("p",null,m().createElement(h.Link,{to:"/about"},"About")),m().createElement("hr",null),m().createElement(w,null)),x=new(a()),k=new(n()),H=u().readFileSync(("assets/index.html",i().resolve(i().join(__dirname,"assets/index.html"))),"utf8");k.get(["/","/about"],(async e=>{const t=(0,A.createStore)(_),a=b.map((a=>{if(a.path===e.req.url&&a.element.type.loadData)return a.element.type.loadData(t)})).filter(Boolean);await Promise.all(a).then((a=>{const r=(e=>t=>e.replace(/<!--(\s\S)*?>-->/g,((e,a)=>{t[a.trim()]})))(H),n=(0,E.renderToString)(m().createElement(f.Provider,{store:t},m().createElement(p.StaticRouter,{location:e.req.url},m().createElement(D,null))));e.body=r({html:n,store:`<script>window.REDUX_STORE = ${JSON.stringify(t.getState())}<\/script>`})}))})),k.get("/getData",(e=>{e.body={code:0,data:"后端返回数据"}})),x.use(o()("assets")),x.use(k.routes()).use(k.allowedMethods()),x.listen(3e3,(()=>{console.log("listening server http://localhost:3000")}))})();