(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("koa");var a=e.n(t);const n=require("@koa/router");var r=e.n(n);const l=require("koa-static");var o=e.n(l);const c=require("react");var u=e.n(c);const i=require("react-dom/server"),d=require("react-router-dom/server"),s=require("react-router-dom"),m=function(){return u().createElement(u().Fragment,null,u().createElement("main",null,u().createElement("h2",null,"Welcome to the homepage!"),u().createElement("p",null,"You can do this, I believe in you.")),u().createElement("nav",null,"Home"))},p=require("axios");var h=e.n(p);const E=require("react-redux");function v(e){const[t,a]=(0,c.useState)("");return(0,c.useEffect)((()=>{e.data||h().get("http://localhost:3000/getData").then((t=>{e.dispatch({type:"CHANGE_STATE",payload:{data:t.data.data}})}))}),[]),u().createElement(u().Fragment,null,u().createElement("main",null,u().createElement("h2",null,"Who are we?")),u().createElement("nav",null,"About"),u().createElement("div",null,e.data))}v.loadData=e=>new Promise((t=>{h().get("http://localhost:3000/getData").then((a=>{e.dispatch({type:"CHANGE_STATE",payload:{data:a.data.data}}),t(a.data.data)}))}));const g=(0,E.connect)((function(e){return{data:e.data}}),(function(e){return{dispatch:e}}))(v),y=[{path:"/",index:!0,element:u().createElement(m,null)},{path:"/about",element:u().createElement(g,null)}],b=()=>(0,s.useRoutes)(y),f=require("redux"),q={data:""};function w(e=q,t){return"CHANGE_STATE"===t.type?{...e,...t.payload}:{...e}}const S=()=>u().createElement("div",null,u().createElement("p",null,u().createElement(s.Link,{to:"/"},"Home")),u().createElement("p",null,u().createElement(s.Link,{to:"/about"},"About")),u().createElement("hr",null),u().createElement(b,null)),T=new(a()),A=new(r());A.get(["/","/about"],(async e=>{const t=(0,f.createStore)(w),a=y.map((a=>{if(a.path===e.req.url&&a.element.type.loadData)return a.element.type.loadData(t)})).filter(Boolean);await Promise.all(a).then((a=>{console.log(a,"data");const n=(0,i.renderToString)(u().createElement(E.Provider,{store:t},u().createElement(d.StaticRouter,{location:e.req.url},u().createElement(S,null))));e.body=`\n      <!DOCTYPE html>\n      <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta http-equiv="X-UA-Compatible" content="IE=edge">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>React-ssr</title>\n      </head>\n      <body>\n        <script>\n          window.REDUX_STORE = ${JSON.stringify(t.getState())}\n        <\/script>\n        <div id="app">${n}</div>\n        <script src="bundle.js"><\/script>\n      </body>\n      </html>\n    `}))})),A.get("/getData",(e=>{e.body={code:0,data:"后端返回数据"}})),T.use(o()("assets")),T.use(A.routes()).use(A.allowedMethods()),T.listen(3e3,(()=>{console.log("listening server http://localhost:3000")}))})();