(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("koa");var n=e.n(t);const a=require("@koa/router");var r=e.n(a);const l=require("koa-static");var o=e.n(l);const c=require("react");var u=e.n(c);const i=require("react-dom/server"),s=require("react-router-dom/server"),d=require("react-router-dom"),m=function(){return u().createElement(u().Fragment,null,u().createElement("main",null,u().createElement("h2",null,"Welcome to the homepage!"),u().createElement("p",null,"You can do this, I believe in you.")),u().createElement("nav",null,"Home"))},h=require("axios");var p=e.n(h);const E=require("react-redux");function v(e){const[t,n]=(0,c.useState)("");return u().createElement(u().Fragment,null,u().createElement("main",null,u().createElement("h2",null,"Who are we?")),u().createElement("nav",null,"About"),u().createElement("div",null,e.data))}v.loadData=e=>new Promise((t=>{p().get("http://localhost:3000/getData").then((n=>{e.dispatch({type:"CHANGE_STATE",payload:{data:n.data.data}}),t(n.data.data)}))}));const g=(0,E.connect)((function(e){return{data:e.data}}))(v),y=[{path:"/",index:!0,element:u().createElement(m,null)},{path:"/about",element:u().createElement(g,null)}],b=()=>(0,d.useRoutes)(y),q=require("redux"),w={data:"hahaha"};function f(e=w,t){return"CHANGE_STATE"===t.type?{...e,...t.payload}:{...e}}const S=()=>u().createElement("div",null,u().createElement("p",null,u().createElement(d.Link,{to:"/"},"Home")),u().createElement("p",null,u().createElement(d.Link,{to:"/about"},"About")),u().createElement("hr",null),u().createElement(b,null)),T=new(n()),A=new(r());A.get(["/","/about"],(async e=>{const t=(0,q.createStore)(f),n=y.map((n=>{if(n.path===e.req.url&&n.element.type.loadData)return n.element.type.loadData(t)})).filter(Boolean);await Promise.all(n).then((n=>{console.log(n,"data");const a=(0,i.renderToString)(u().createElement(E.Provider,{store:t},u().createElement(s.StaticRouter,{location:e.req.url},u().createElement(S,null))));e.body=`\n      <!DOCTYPE html>\n      <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta http-equiv="X-UA-Compatible" content="IE=edge">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>React-ssr</title>\n      </head>\n      <body>\n        <script>\n          window.REDUX_STORE = ${JSON.stringify(t.getState())}\n        <\/script>\n        <div id="app">${a}</div>\n        <script src="bundle.js"><\/script>\n      </body>\n      </html>\n    `}))})),A.get("/getData",(e=>{e.body={code:0,data:"后端返回数据"}})),T.use(o()("assets")),T.use(A.routes()).use(A.allowedMethods()),T.listen(3e3,(()=>{console.log("listening server http://localhost:3000")}))})();